# poster

Для запуска сервиса нужно выполнить команду
make start WITH-DB=postgres или in-memory
В первом случае будет поднята база вместе с сервисом

Данные для подключения к БД хранятся в виде системных переменных в файле config/config.env.
По идее этот файл должен храниться отдельно от проекта, но для удобства запуска одной командой я закинула этот файлик в проект.

Для генерации сервиса c GraphQL используется библиотека gqlgen
Обработчики БД хранятся в пакетах postgres и inmemory и имеют общий интерфейс common.Database.

Тесты были реализованы в отдельном пакете tests.

Создание таблиц в БД реализовано через миграции. Я использовала инструмент goose.
Для того, чтобы в Makefile одной командой запускать тесты и сервис вместе с БД я обнаружила, что БД готова к использованию не сразу.
Поискав в интернете, я нашла способ, что надо добавить в docker-compose.yml healthchecks и ждать, пока БД не будет healthy.

Получение комментариев реализовано по аналогии с reddit.
Выводятся комментарии верхнего уровня и, при наличии, выводятся по 1 комментарию следующего уровня. Для каждого комментария указано количество дочерних комментариев.
Чтобы получить список дочерних комментариев, необходимо передать в функцию commentID - id родительского комментария

Также реализована возможность проставления лайков комментариям и постам и подписка на комментарии.

Ошибки из postgres не успела обработать в виде, подходящем для пользователя. Например, при создании поста для несуществующего автора будет выводиться:
"pq: insert or update on table \"posts\" violates foreign key constraint \"fk_user_post\""